import{r as p,x as E,e as S,y as C,b as I,f as M,w as y,o as N,a as n,h as _,l as m,s as b,v as j}from"./app-DtuGJrLF.js";import{_ as A}from"./AuthenticatedLayout-DDyCWe83.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const T={class:"flex justify-center"},z={class:"w-[75%]"},R={class:"mb-4"},$={class:"mb-4"},q={class:"mb-4"},L={__name:"FarmInformation",setup(G){const g=p(""),u=p(0),t=E({lat:14.5995,lng:120.9842}),c=p(""),v=p(!1);let d,r;const k=()=>new Promise((o,e)=>{if(window.google&&window.google.maps){o();return}const s=document.createElement("script");s.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCL_IiN0vAn1y3Z_ZttsmYwi4R1fgXD1zU&callback=initGoogleMaps",s.async=!0,s.defer=!0,window.initGoogleMaps=()=>{v.value=!0,o()},s.onerror=e,document.head.appendChild(s)}),f=async()=>{try{const o=await fetch("/api/pigfarminformation",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},credentials:"include"});if(!o.ok)throw new Error("Network response was not ok");const e=await o.json();console.log(e),e&&(g.value=e.feeding_type,u.value=e.frequency_of_feeding,t.lat=e.latitude,t.lng=e.longitude,r&&(r.setPosition({lat:t.lat,lng:t.lng}),d.setCenter({lat:t.lat,lng:t.lng})),await w(t.lat,t.lng))}catch(o){console.error("Error fetching farm information:",o)}},w=async(o,e)=>{const i=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${o},${e}&key=AIzaSyCL_IiN0vAn1y3Z_ZttsmYwi4R1fgXD1zU`;try{const a=await fetch(i);if(!a.ok)throw new Error("Network response was not ok");const l=await a.json();console.log("Reverse Geocoding Result:",l),l.results&&l.results.length>0&&(c.value=l.results[0].formatted_address)}catch(a){console.error("Error performing reverse geocoding:",a)}},h=async o=>{const s=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(o)}&key=AIzaSyCL_IiN0vAn1y3Z_ZttsmYwi4R1fgXD1zU`;try{const i=await fetch(s);if(!i.ok)throw new Error("Network response was not ok");const a=await i.json();if(console.log("Geocoding Result:",a),a.results&&a.results.length>0){const l=a.results[0].geometry.location;t.lat=l.lat,t.lng=l.lng,r&&(r.setPosition({lat:t.lat,lng:t.lng}),d.setCenter({lat:t.lat,lng:t.lng}))}}catch(i){console.error("Error performing geocoding:",i)}},x=()=>{d=new google.maps.Map(document.getElementById("map"),{center:{lat:t.lat,lng:t.lng},zoom:13}),r=new google.maps.Marker({position:{lat:t.lat,lng:t.lng},map:d,draggable:!0}),google.maps.event.addListener(r,"dragend",async function(){const o=r.getPosition();t.lat=o.lat(),t.lng=o.lng(),d.setCenter({lat:t.lat,lng:t.lng}),await w(t.lat,t.lng)})},F=async()=>{try{const o=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),e=await fetch("/api/pigfarminformation",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":o,Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({feedingType:g.value,frequencyOfFeeding:u.value,location:t,address:c.value})});if(!e.ok)throw new Error("Network response was not ok");const s=await e.json();console.log("Form submitted successfully:",s),await f(),window.location.reload()}catch(o){console.error("Error submitting form:",o)}};return S(async()=>{try{await k(),await f(),x()}catch(o){console.error("Error loading Google Maps:",o)}}),C(c,async o=>{o&&await h(o)}),(o,e)=>(N(),I("div",null,[M(A,null,{header:y(()=>e[3]||(e[3]=[n("h2",{class:"font-semibold text-xl text-[#543434] leading-tight"},"Farm Details",-1)])),default:y(()=>[n("main",null,[n("div",T,[n("div",z,[n("form",{onSubmit:_(F,["prevent"]),class:"place-content-center"},[e[8]||(e[8]=n("div",{class:"mb-4"},[n("label",{for:"location",class:"block text-sm font-medium text-[#543434]"},"Location"),n("div",{id:"map",class:"w-full h-64"})],-1)),n("div",R,[e[4]||(e[4]=n("label",{for:"address",class:"block text-sm font-medium text-[#543434]"},"Address",-1)),m(n("input",{type:"text",id:"address","onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),class:"mt-1 block w-full p-2.5 bg-[#c58a61] border border-[#c59461] text-[#543434] rounded-lg focus:ring-[#c58a61] focus:border-[#c58a61]"},null,512),[[b,c.value]])]),n("div",$,[e[6]||(e[6]=n("label",{for:"feedingType",class:"block text-sm font-medium text-[#543434]"},"Feeding Type",-1)),m(n("select",{id:"feedingType","onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),class:"mt-1 block w-full p-2.5 bg-[#c58a61] border border-[#c59461] text-[#543434] rounded-lg focus:ring-[#c58a61] focus:border-[#c58a61]"},e[5]||(e[5]=[n("option",{value:"feed"},"Feed",-1),n("option",{value:"natural"},"Natural",-1)]),512),[[j,g.value]])]),n("div",q,[e[7]||(e[7]=n("label",{for:"frequencyOfFeeding",class:"block text-sm font-medium text-[#543434]"},"Frequency of Feeding",-1)),m(n("input",{type:"text",id:"frequencyOfFeeding","onUpdate:modelValue":e[2]||(e[2]=s=>u.value=s),class:"mt-1 block w-full p-2.5 bg-[#c58a61] border border-[#c59461] text-[#543434] rounded-lg focus:ring-[#c58a61] focus:border-[#c58a61]"},null,512),[[b,u.value]])]),e[9]||(e[9]=n("button",{type:"submit",class:"w-full bg-[#281c11] text-white p-2.5 rounded-lg focus:ring-4 focus:ring-[#c58a61]"},"Submit",-1))],32)])])])]),_:1})]))}};export{L as default};
