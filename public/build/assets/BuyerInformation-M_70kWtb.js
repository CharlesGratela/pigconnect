import{y as I,r as b,h as _,z as B,e as p,i as S,w as C,o as m,b as e,t as y,g as h,d as N,l as A,m as T,v as G}from"./app-DNIPENlQ.js";import{_ as P}from"./AuthenticatedLayout-BOqvg2qA.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"py-8"},R={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"},U={class:"bg-white rounded-2xl shadow-lg p-6 mb-8 border border-gray-100"},V={key:0,class:"bg-gradient-to-r from-emerald-50 to-emerald-100 rounded-xl p-4 mb-6"},$={class:"flex items-center space-x-3"},D={class:"text-emerald-900 font-semibold"},K={class:"bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100"},O={class:"p-6"},Y={class:"space-y-4"},X={class:"bg-gray-50 rounded-xl p-4 border-2 border-gray-200"},Z={class:"flex items-center justify-between mb-3"},q={class:"flex items-center space-x-3"},J=["disabled"],H={key:0,class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Q={key:1,class:"w-4 h-4 mr-1 animate-spin",fill:"none",viewBox:"0 0 24 24"},W={key:0,class:"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg"},ee={class:"flex items-center space-x-2"},oe={class:"text-sm text-red-700"},te={key:1,class:"mb-3 p-3 bg-emerald-50 border border-emerald-200 rounded-lg"},re={class:"relative"},ie={__name:"BuyerInformation",setup(se){const r=I({lat:14.5995,lng:120.9842}),d=b(""),u=b(!1),g=b("");let l,i;const M=()=>new Promise((t,o)=>{if(!navigator.geolocation){o(new Error("Geolocation is not supported by this browser."));return}u.value=!0,g.value="",navigator.geolocation.getCurrentPosition(s=>{const n=s.coords.latitude,a=s.coords.longitude;console.log("User location obtained:",n,a),u.value=!1,t({lat:n,lng:a})},s=>{u.value=!1;let n="";switch(s.code){case s.PERMISSION_DENIED:n="Location access denied by user.";break;case s.POSITION_UNAVAILABLE:n="Location information is unavailable.";break;case s.TIMEOUT:n="Location request timed out.";break;default:n="An unknown error occurred while retrieving location.";break}g.value=n,console.error("Geolocation error:",n),o(new Error(n))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}),k=async()=>{try{const t=await fetch("/api/buyerinformation",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},credentials:"include"});if(!t.ok)throw new Error("Network response was not ok");const o=await t.json();if(console.log(o),o&&o.latitude!=null&&o.longitude!=null){const s=parseFloat(o.latitude),n=parseFloat(o.longitude);!isNaN(s)&&!isNaN(n)&&s>=-90&&s<=90&&n>=-180&&n<=180&&(r.lat=s,r.lng=n,i&&l&&(i.setPosition({lat:r.lat,lng:r.lng}),l.setCenter({lat:r.lat,lng:r.lng})),await x(r.lat,r.lng))}else console.log("No saved location found, attempting to get current location..."),await v()}catch(t){console.error("Error fetching buyer information:",t),await v()}},v=async()=>{try{const t=await M();r.lat=t.lat,r.lng=t.lng,i&&l&&(i.setPosition({lat:r.lat,lng:r.lng}),l.setCenter({lat:r.lat,lng:r.lng})),await x(r.lat,r.lng),console.log("Auto-location successful:",t)}catch(t){console.warn("Auto-location failed, using default location:",t.message),g.value=`Could not get your location: ${t.message}`}},x=async(t,o)=>{if(isNaN(t)||isNaN(o)||t===void 0||o===void 0){console.error("Invalid coordinates for reverse geocoding:",t,o);return}const n=`https://maps.googleapis.com/maps/api/geocode/json?latlng=${t},${o}&key=AIzaSyC7qjUE5KQyJJkjvXGpsf-MeKVTbGXt490`;try{const a=await fetch(n);if(!a.ok)throw new Error("Network response was not ok");const c=await a.json();console.log("Reverse Geocoding Result:",c),c.results&&c.results.length>0&&(d.value=c.results[0].formatted_address)}catch(a){console.error("Error performing reverse geocoding:",a)}},L=async t=>{if(!t||t.trim()===""){console.warn("Empty address provided for geocoding");return}const s=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(t)}&key=AIzaSyCL_IiN0vAn1y3Z_ZttsmYwi4R1fgXD1zU`;try{const n=await fetch(s);if(!n.ok)throw new Error("Network response was not ok");const a=await n.json();if(console.log("Geocoding Result:",a),a.results&&a.results.length>0){const c=a.results[0].geometry.location,f=parseFloat(c.lat),w=parseFloat(c.lng);!isNaN(f)&&!isNaN(w)&&f>=-90&&f<=90&&w>=-180&&w<=180?(r.lat=f,r.lng=w,i&&l&&(i.setPosition({lat:r.lat,lng:r.lng}),l.setCenter({lat:r.lat,lng:r.lng}))):console.error("Invalid coordinates from geocoding:",c)}else console.warn("No geocoding results found for address:",t)}catch(n){console.error("Error performing geocoding:",n)}},z=()=>{(isNaN(r.lat)||isNaN(r.lng))&&(console.warn("Invalid coordinates for map initialization, using default location"),r.lat=14.5995,r.lng=120.9842);try{l=new google.maps.Map(document.getElementById("map"),{center:{lat:r.lat,lng:r.lng},zoom:13,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0}),i=new google.maps.Marker({position:{lat:r.lat,lng:r.lng},map:l,draggable:!0,title:"Your Location"}),google.maps.event.addListener(i,"dragend",async function(){const t=i.getPosition(),o=t.lat(),s=t.lng();!isNaN(o)&&!isNaN(s)&&(r.lat=o,r.lng=s,l.setCenter({lat:r.lat,lng:r.lng}),await x(r.lat,r.lng))}),console.log("Google Maps initialized successfully")}catch(t){console.error("Error initializing Google Maps:",t)}},j=async()=>{try{const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),o=await fetch("api/buyerinformationstore",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({location:r,address:d.value,latitude:r.lat,longitude:r.lng})});if(!o.ok)throw new Error("Network response was not ok");const s=await o.json();console.log("Form submitted successfully:",s),await k(),window.location.reload()}catch(t){console.error("Error submitting form:",t)}};_(async()=>{try{await E(),z(),await k()}catch(t){console.error("Error during initialization:",t)}});const E=()=>new Promise((t,o)=>{if(window.google&&window.google.maps){t();return}const s=document.createElement("script");s.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCL_IiN0vAn1y3Z_ZttsmYwi4R1fgXD1zU&libraries=places&loading=async",s.async=!0,s.defer=!0,s.onload=()=>{t()},s.onerror=o,document.head.appendChild(s)});return B(d,async t=>{t&&await L(t)}),(t,o)=>(m(),p("div",null,[S(P,null,{header:C(()=>o[1]||(o[1]=[e("div",{class:"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white p-6 rounded-2xl shadow-lg"},[e("div",{class:"flex items-center space-x-3"},[e("div",{class:"bg-white/20 p-3 rounded-xl backdrop-blur-sm"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])]),e("div",null,[e("h2",{class:"text-3xl font-bold"},"Buyer Information"),e("p",{class:"text-emerald-100 mt-1"},"Manage your profile and location preferences")])])],-1)])),default:C(()=>[e("main",F,[e("div",R,[e("div",U,[o[4]||(o[4]=e("div",{class:"flex items-center justify-between mb-6"},[e("div",null,[e("h3",{class:"text-2xl font-bold text-gray-800"},"Profile Setup"),e("p",{class:"text-gray-600 mt-1"},"Configure your location for better pig recommendations")]),e("div",{class:"bg-emerald-100 p-3 rounded-xl"},[e("svg",{class:"w-8 h-8 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])])],-1)),d.value?(m(),p("div",V,[e("div",$,[o[3]||(o[3]=e("div",{class:"bg-emerald-600 text-white rounded-lg p-2"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})])],-1)),e("div",null,[o[2]||(o[2]=e("p",{class:"text-sm font-medium text-emerald-800"},"Current Location",-1)),e("p",D,y(d.value),1)])])])):h("",!0)]),e("div",K,[o[16]||(o[16]=e("div",{class:"bg-gradient-to-r from-emerald-50 to-emerald-100 p-6 border-b border-gray-200"},[e("h3",{class:"text-xl font-bold text-emerald-800 flex items-center gap-3"},[e("div",{class:"bg-emerald-600 p-2 rounded-lg"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})])]),N(" Location Settings ")]),e("p",{class:"text-emerald-600 mt-1"},"Set your location to find nearby pig farms and get better recommendations")],-1)),e("div",O,[e("form",{onSubmit:A(j,["prevent"]),class:"space-y-8"},[e("div",Y,[o[14]||(o[14]=e("h4",{class:"text-lg font-bold text-gray-800 flex items-center space-x-2"},[e("svg",{class:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})]),e("span",null,"Your Location")],-1)),e("div",X,[e("div",Z,[o[7]||(o[7]=e("label",{class:"block text-sm font-medium text-gray-700"}," Interactive Map (Drag marker to set your exact location) ",-1)),e("div",q,[e("button",{type:"button",onClick:v,disabled:u.value,class:"inline-flex items-center px-3 py-2 text-xs font-medium rounded-lg border border-emerald-300 text-emerald-700 bg-emerald-50 hover:bg-emerald-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-1 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"},[u.value?(m(),p("svg",Q,o[6]||(o[6]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(m(),p("svg",H,o[5]||(o[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"},null,-1)]))),N(" "+y(u.value?"Getting Location...":"Use My Location"),1)],8,J)])]),g.value?(m(),p("div",W,[e("div",ee,[o[8]||(o[8]=e("svg",{class:"w-5 h-5 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",oe,y(g.value),1)])])):h("",!0),d.value&&!u.value&&!g.value?(m(),p("div",te,o[9]||(o[9]=[e("div",{class:"flex items-center space-x-2"},[e("svg",{class:"w-5 h-5 text-emerald-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),e("p",{class:"text-sm text-emerald-700"},"Location updated successfully!")],-1)]))):h("",!0),o[10]||(o[10]=e("div",{id:"map",class:"w-full rounded-lg shadow-md border border-gray-300"},null,-1))]),e("div",null,[o[12]||(o[12]=e("label",{for:"address",class:"block text-sm font-bold text-gray-700 mb-2"},"Your Address",-1)),e("div",re,[T(e("input",{type:"text",id:"address","onUpdate:modelValue":o[0]||(o[0]=s=>d.value=s),placeholder:"Enter your address...",class:"w-full px-4 py-3 bg-white border-2 border-gray-200 text-gray-800 rounded-xl focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all duration-200 pl-12"},null,512),[[G,d.value]]),o[11]||(o[11]=e("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{class:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"})])],-1))]),o[13]||(o[13]=e("p",{class:"text-xs text-gray-500 mt-1"},"This helps us show you nearby pig farms and relevant recommendations",-1))])]),o[15]||(o[15]=e("div",{class:"pt-6 border-t border-gray-200"},[e("button",{type:"submit",class:"w-full bg-gradient-to-r from-emerald-600 to-emerald-700 text-white px-6 py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-[1.02]"},[e("span",{class:"flex items-center justify-center space-x-2"},[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})]),e("span",null,"Save Location Information")])])],-1))],32)])]),o[17]||(o[17]=e("div",{class:"mt-8 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-200"},[e("div",{class:"flex items-start space-x-3"},[e("div",{class:"bg-blue-100 p-2 rounded-xl"},[e("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])]),e("div",null,[e("h4",{class:"font-bold text-blue-800 mb-2"},"Why Set Your Location?"),e("ul",{class:"text-blue-700 space-y-1 text-sm"},[e("li",null,"• Find pig farms near your area"),e("li",null,"• Get personalized pig recommendations"),e("li",null,"• Reduce transportation costs and time"),e("li",null,"• Connect with local farmers in your region")])])])],-1))])])]),_:1})]))}};export{ie as default};
