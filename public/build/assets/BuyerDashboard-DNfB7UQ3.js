import{r as c,e as M,b as l,f as w,w as x,a as e,t as a,u as T,F as _,d as k,h as B,l as y,v as D,q as P,s as A,i as $,o as i,g as O,k as R}from"./app-BBvVVKdH.js";import{_ as V}from"./AuthenticatedLayout-DUguJAC5.js";const z={class:"flex justify-center"},q={class:"w-full md:w-[75%]"},K={key:0,class:"text-center text-[#543434]"},L={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},U={class:"flex items-center mb-4"},X=["src"],J={class:"text-lg font-semibold text-[#543434]"},W=["onClick"],Y={class:"mb-2"},G={class:"text-[#543434]"},H={class:"mb-2"},Q={class:"text-[#543434]"},Z={class:"mb-2"},tt={class:"text-[#543434]"},et={class:"mb-2"},st={class:"text-[#543434]"},ot={key:0,class:"fixed inset-0 flex items-center justify-center z-50 bg-[#543434] bg-opacity-75"},nt={class:"bg-white p-6 rounded-lg shadow-lg w-[90%] md:w-[50%] h-[80%] overflow-y-auto"},at={class:"mb-4 flex justify-center"},lt=["src"],it={class:"mb-2 text-center"},rt={class:"text-xl text-[#543434]"},dt={class:"mb-2 text-center"},ct={class:"text-xl text-[#543434]"},mt={class:"mb-2 text-center"},ut={class:"text-xl text-[#543434]"},gt={class:"mb-2 text-center"},pt={class:"text-xl text-[#543434]"},ft={class:"mb-2 text-center"},bt={class:"text-xl text-[#543434]"},xt={class:"mb-2 text-center"},vt={class:"mb-2 text-center"},ht={class:"text-xl text-[#543434]"},wt={class:"mb-4"},_t={key:0,class:"text-center text-[#543434]"},kt={key:1},yt={class:"flex justify-between"},It={class:"font-semibold text-[#543434]"},Ft={class:"text-[#543434]"},St={class:"text-[#543434]"},Nt={class:"mb-4"},Et={class:"mb-2"},jt={class:"mb-2"},Bt={__name:"BuyerDashboard",setup(Ct){const u=c([]),g=c(!1),n=c(null),p=c(null),m=c([]),r=c({rating:5,comment:""}),I=async()=>{try{const s=await fetch("/api/recommendations",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok)throw new Error("Network response was not ok");const t=await s.json();u.value=t.recommendations}catch(s){console.error("Error fetching recommendations:",s)}},v=s=>{const t=new Date(s),o=new Date;return(o.getFullYear()-t.getFullYear())*12+(o.getMonth()-t.getMonth())},F=async s=>{n.value=s,n.value.pigId=s.pigId,n.value.price_per_kilo=s.price_per_kilo,n.value.breed=s.breed,g.value=!0,p.value=s.user_id,await N(s.user_id),await h(s.pigId),await j(n.value.pigId)},S=()=>{g.value=!1},N=async s=>{try{const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),o=await fetch(`/api/pigfarminformation/buyer?user_id=${s}`,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!o.ok)throw new Error("Network response was not ok");const d=await o.json();n.value.id=d.id,n.value.owner=d.owner_name,n.value.location=d.location;const f=parseFloat(d.latitude),b=parseFloat(d.longitude);isFinite(f)&&isFinite(b)?C(f,b):(console.error("Invalid latitude or longitude:",f,b),alert("Invalid location data"))}catch(t){console.error("Error fetching farm details:",t),alert("Failed to fetch farm details")}},h=async s=>{try{const t=await fetch(`/api/pigs/${s}/feedback`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Network response was not ok");const o=await t.json();m.value=o}catch(t){console.error("Error fetching feedback:",t),alert("Failed to fetch feedback")}},E=async()=>{try{const s=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),t=await fetch(`/api/pigs/${n.value.pigId}/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s},body:JSON.stringify({pig_id:n.value.pigId,comment:r.value.comment,rating:r.value.rating})});if(!t.ok)throw new Error("Network response was not ok");const o=await t.json();m.value.push(o),r.value.rating=5,r.value.comment="",h(n.value.pigId)}catch(s){console.error("Error submitting feedback:",s),alert("Failed to submit feedback")}},j=async s=>{try{const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content");if(!(await fetch("/api/track_interaction",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({pig_id:s})})).ok)throw new Error("Network response was not ok");console.log("Interaction tracked successfully")}catch(t){console.error("Error tracking interaction:",t)}},C=(s,t)=>{const o=new google.maps.Map(document.getElementById("map"),{center:{lat:s,lng:t},zoom:15});new google.maps.Marker({position:{lat:s,lng:t},map:o,title:"Pig Location"})};return M(()=>{I()}),(s,t)=>(i(),l("div",null,[w(V,null,{header:x(()=>t[2]||(t[2]=[e("h2",{class:"font-semibold text-xl text-[#543434] leading-tight"},"Buyer Dashboard",-1)])),default:x(()=>[e("main",null,[e("div",z,[e("div",q,[t[7]||(t[7]=e("h3",{class:"text-lg font-semibold text-[#543434] mb-4"},"Recommended Pigs",-1)),u.value.length===0?(i(),l("div",K," No recommendations available. ")):(i(),l("div",L,[(i(!0),l(_,null,k(u.value,o=>(i(),l("div",{key:o.pigId,class:"p-4 bg-white rounded-lg shadow-md"},[e("div",U,[e("img",{src:`/storage/${o.image}`,alt:"Pig Image",class:"w-24 h-24 sm:w-28 sm:h-28 rounded-lg mr-4 object-cover"},null,8,X),e("div",null,[e("h3",J,a(o.pigId),1),e("button",{onClick:d=>F(o),class:"text-[#c58a61] hover:underline"},"View Details",8,W)])]),e("div",Y,[t[3]||(t[3]=e("span",{class:"font-semibold text-[#543434]"},"Breed:",-1)),e("span",G,a(o.breed)+" per kilo",1)]),e("div",H,[t[4]||(t[4]=e("span",{class:"font-semibold text-[#543434]"},"Weight: ",-1)),e("span",Q,a(o.weight)+" kg.",1)]),e("div",Z,[t[5]||(t[5]=e("span",{class:"font-semibold text-[#543434]"},"Age:",-1)),e("span",tt,a(v(o.date_of_birth))+" months",1)]),e("div",et,[t[6]||(t[6]=e("span",{class:"font-semibold text-[#543434]"},"Price Range:",-1)),e("span",st,"₱ "+a(o.price_per_kilo)+" per kilo",1)])]))),128))]))])])])]),_:1}),g.value?(i(),l("div",ot,[e("div",nt,[t[21]||(t[21]=e("h3",{class:"text-2xl font-bold text-[#543434] mb-4 text-center"},"Pig Details",-1)),e("div",at,[e("img",{src:`/storage/${n.value.image}`,alt:"Pig Image",class:"w-48 h-48 rounded-lg object-cover"},null,8,lt)]),e("div",it,[t[8]||(t[8]=e("span",{class:"text-xl font-semibold text-[#543434]"},"Owner: ",-1)),e("span",rt,a(n.value.owner),1)]),e("div",dt,[t[9]||(t[9]=e("span",{class:"text-xl font-semibold text-[#543434]"},"Breed:",-1)),e("span",ct,a(n.value.breed),1)]),e("div",mt,[t[10]||(t[10]=e("span",{class:"text-xl font-semibold text-[#543434]"},"Weight:",-1)),e("span",ut,a(n.value.weight)+" kg",1)]),e("div",gt,[t[11]||(t[11]=e("span",{class:"text-xl font-semibold text-[#543434]"},"Age:",-1)),e("span",pt,a(v(n.value.date_of_birth))+" months",1)]),e("div",ft,[t[12]||(t[12]=e("span",{class:"text-xl font-semibold text-[#543434]"},"Price Range:",-1)),e("span",bt,"₱ "+a(n.value.price_per_kilo)+" per kilo",1)]),t[22]||(t[22]=e("div",{class:"mb-2 text-center"},[e("span",{class:"text-xl font-semibold text-[#543434]"},"Interested with the pig? ")],-1)),e("div",xt,[e("span",null,[w(T(R),{href:s.route("chat.index",{userId:p.value}),active:s.route("chat.index",{userId:p.value}),class:"mt-2 bg-[#c58a61] text-white p-2.5 rounded-lg focus:ring-4 focus:ring-[#c58a61]"},{default:x(()=>t[13]||(t[13]=[O(" Message the Seller. ")])),_:1},8,["href","active"])])]),e("div",vt,[t[14]||(t[14]=e("span",{class:"text-xl font-semibold text-[#543434]"},"Location:",-1)),e("span",ht,a(n.value.location),1)]),t[23]||(t[23]=e("div",{id:"map",class:"w-full h-64 mb-4"},null,-1)),e("div",wt,[t[15]||(t[15]=e("h4",{class:"text-lg font-semibold text-[#543434] mb-2"},"Feedback",-1)),m.value.length===0?(i(),l("div",_t," No feedback available. ")):(i(),l("div",kt,[(i(!0),l(_,null,k(m.value,o=>(i(),l("div",{key:o.id,class:"mb-2 p-2 bg-[#c58a61] rounded-lg"},[e("div",yt,[e("span",It,a(o.user.name),1),e("span",Ft,a(o.rating)+" / 5",1)]),e("p",St,a(o.comment),1)]))),128))]))]),e("div",Nt,[t[20]||(t[20]=e("h4",{class:"text-lg font-semibold text-[#543434] mb-2"},"Add Feedback",-1)),e("form",{onSubmit:B(E,["prevent"])},[e("div",Et,[t[17]||(t[17]=e("label",{for:"rating",class:"block text-[#543434]"},"Rating:",-1)),y(e("select",{id:"rating","onUpdate:modelValue":t[0]||(t[0]=o=>r.value.rating=o),class:"w-full p-2 border rounded-lg"},t[16]||(t[16]=[P('<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>',5)]),512),[[D,r.value.rating]])]),e("div",jt,[t[18]||(t[18]=e("label",{for:"comment",class:"block text-[#543434]"},"Comment:",-1)),y(e("textarea",{id:"comment","onUpdate:modelValue":t[1]||(t[1]=o=>r.value.comment=o),class:"w-full p-2 border rounded-lg"},null,512),[[A,r.value.comment]])]),t[19]||(t[19]=e("button",{type:"submit",class:"mt-2 bg-[#c58a61] text-white p-2.5 rounded-lg focus:ring-4 focus:ring-[#c58a61]"},"Submit",-1))],32)]),e("div",{class:"flex justify-center"},[e("button",{onClick:S,class:"mt-4 bg-[#c58a61] text-white p-2.5 rounded-lg focus:ring-4 focus:ring-[#c58a61]"},"Close")])])])):$("",!0)]))}};export{Bt as default};
