import{r as c,e as C,b as l,f as x,w as v,a as t,t as a,u as B,F as k,d as _,h as T,l as y,v as D,q as P,s as A,i as $,o as r,g as O,k as V}from"./app-DtuGJrLF.js";import{_ as R}from"./AuthenticatedLayout-DDyCWe83.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"flex justify-center"},q={class:"w-full md:w-[75%]"},L={key:0,class:"text-center text-[#543434]"},K={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},U={class:"flex items-center mb-4"},X=["src"],J={class:"text-lg font-semibold text-[#543434]"},W=["onClick"],Y={class:"mb-2"},G={class:"text-[#543434]"},H={class:"mb-2"},Q={class:"text-[#543434]"},Z={class:"mb-2"},ee={class:"text-[#543434]"},te={class:"mb-2"},se={class:"text-[#543434]"},oe={key:0,class:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50"},ne={class:"bg-white p-6 rounded-lg shadow-xl w-[95%] md:w-[80%] lg:w-[60%] max-h-[90vh] overflow-y-auto"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},le={class:"space-y-4"},re={class:"aspect-square w-full overflow-hidden rounded-lg"},ie=["src"],de={class:"bg-gray-50 p-4 rounded-lg space-y-3"},ce={class:"flex justify-between items-center"},ue={class:"text-[#543434]"},me={class:"flex justify-between items-center"},ge={class:"text-[#543434]"},pe={class:"flex justify-between items-center"},fe={class:"text-[#543434]"},be={class:"flex justify-between items-center"},ve={class:"text-[#543434]"},he={class:"flex justify-between items-center"},we={class:"text-[#543434]"},xe={class:"space-y-4"},ke={class:"bg-gray-50 p-4 rounded-lg"},_e={class:"text-[#543434] mb-4"},ye={class:"bg-gray-50 p-4 rounded-lg"},Ie={class:"mt-6 space-y-6"},Fe={class:"bg-gray-50 p-4 rounded-lg"},Se={key:0,class:"text-center text-gray-500 py-4"},je={key:1,class:"space-y-3"},Ne={class:"flex justify-between items-center mb-2"},Ee={class:"font-semibold text-[#543434]"},Me={class:"flex items-center"},Ce={class:"text-[#543434]"},Be={class:"text-[#543434]"},Te={class:"bg-gray-50 p-4 rounded-lg"},Oe={__name:"BuyerDashboard",setup(De){const m=c([]),g=c(!1),n=c(null),p=c(null),u=c([]),i=c({rating:5,comment:""}),I=async()=>{try{const s=await fetch("/api/recommendations",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!s.ok)throw new Error("Network response was not ok");const e=await s.json();m.value=e.recommendations}catch(s){console.error("Error fetching recommendations:",s)}},h=s=>{const e=new Date(s),o=new Date;return(o.getFullYear()-e.getFullYear())*12+(o.getMonth()-e.getMonth())},F=async s=>{n.value=s,n.value.pigId=s.pigId,n.value.price_per_kilo=s.price_per_kilo,n.value.breed=s.breed,g.value=!0,p.value=s.user_id,await j(s.user_id),await w(s.pigId),await E(n.value.pigId)},S=()=>{g.value=!1},j=async s=>{try{const e=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),o=await fetch(`/api/pigfarminformation/buyer?user_id=${s}`,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e,Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!o.ok)throw new Error("Network response was not ok");const d=await o.json();n.value.id=d.id,n.value.owner=d.owner_name,n.value.location=d.location;const f=parseFloat(d.latitude),b=parseFloat(d.longitude);isFinite(f)&&isFinite(b)?M(f,b):(console.error("Invalid latitude or longitude:",f,b),alert("Invalid location data"))}catch(e){console.error("Error fetching farm details:",e),alert("Failed to fetch farm details")}},w=async s=>{try{const e=await fetch(`/api/pigs/${s}/feedback`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error("Network response was not ok");const o=await e.json();u.value=o}catch(e){console.error("Error fetching feedback:",e),alert("Failed to fetch feedback")}},N=async()=>{try{const s=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),e=await fetch(`/api/pigs/${n.value.pigId}/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s},body:JSON.stringify({pig_id:n.value.pigId,comment:i.value.comment,rating:i.value.rating})});if(!e.ok)throw new Error("Network response was not ok");const o=await e.json();u.value.push(o),i.value.rating=5,i.value.comment="",w(n.value.pigId)}catch(s){console.error("Error submitting feedback:",s),alert("Failed to submit feedback")}},E=async s=>{try{const e=document.querySelector('meta[name="csrf-token"]').getAttribute("content");if(!(await fetch("/api/track_interaction",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e,Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({pig_id:s})})).ok)throw new Error("Network response was not ok");console.log("Interaction tracked successfully")}catch(e){console.error("Error tracking interaction:",e)}},M=(s,e)=>{const o=new google.maps.Map(document.getElementById("map"),{center:{lat:s,lng:e},zoom:15});new google.maps.Marker({position:{lat:s,lng:e},map:o,title:"Pig Location"})};return C(()=>{I()}),(s,e)=>(r(),l("div",null,[x(R,null,{header:v(()=>e[2]||(e[2]=[t("h2",{class:"font-semibold text-xl text-[#543434] leading-tight"},"Buyer Dashboard",-1)])),default:v(()=>[t("main",null,[t("div",z,[t("div",q,[e[7]||(e[7]=t("h3",{class:"text-lg font-semibold text-[#543434] mb-4"},"Recommended Pigs",-1)),m.value.length===0?(r(),l("div",L," No recommendations available. ")):(r(),l("div",K,[(r(!0),l(k,null,_(m.value,o=>(r(),l("div",{key:o.pigId,class:"p-4 bg-white rounded-lg shadow-md"},[t("div",U,[t("img",{src:`/storage/${o.image}`,alt:"Pig Image",class:"w-24 h-24 sm:w-28 sm:h-28 rounded-lg mr-4 object-cover"},null,8,X),t("div",null,[t("h3",J,a(o.pigId),1),t("button",{onClick:d=>F(o),class:"text-[#c58a61] hover:underline"},"View Details",8,W)])]),t("div",Y,[e[3]||(e[3]=t("span",{class:"font-semibold text-[#543434]"},"Breed:",-1)),t("span",G,a(o.breed)+" per kilo",1)]),t("div",H,[e[4]||(e[4]=t("span",{class:"font-semibold text-[#543434]"},"Weight: ",-1)),t("span",Q,a(o.weight)+" kg.",1)]),t("div",Z,[e[5]||(e[5]=t("span",{class:"font-semibold text-[#543434]"},"Age:",-1)),t("span",ee,a(h(o.date_of_birth))+" months",1)]),t("div",te,[e[6]||(e[6]=t("span",{class:"font-semibold text-[#543434]"},"Price Range:",-1)),t("span",se,"₱ "+a(o.price_per_kilo)+" per kilo",1)])]))),128))]))])])])]),_:1}),g.value?(r(),l("div",oe,[t("div",ne,[t("div",{class:"flex justify-between items-center mb-6"},[e[9]||(e[9]=t("h3",{class:"text-2xl font-bold text-[#543434]"},"Pig Details",-1)),t("button",{onClick:S,class:"text-gray-500 hover:text-gray-700"},e[8]||(e[8]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),t("div",ae,[t("div",le,[t("div",re,[t("img",{src:`/storage/${n.value.image}`,alt:"Pig Image",class:"w-full h-full object-cover"},null,8,ie)]),t("div",de,[t("div",ce,[e[10]||(e[10]=t("span",{class:"font-semibold text-[#543434]"},"Owner:",-1)),t("span",ue,a(n.value.owner),1)]),t("div",me,[e[11]||(e[11]=t("span",{class:"font-semibold text-[#543434]"},"Breed:",-1)),t("span",ge,a(n.value.breed),1)]),t("div",pe,[e[12]||(e[12]=t("span",{class:"font-semibold text-[#543434]"},"Weight:",-1)),t("span",fe,a(n.value.weight)+" kg",1)]),t("div",be,[e[13]||(e[13]=t("span",{class:"font-semibold text-[#543434]"},"Age:",-1)),t("span",ve,a(h(n.value.date_of_birth))+" months",1)]),t("div",he,[e[14]||(e[14]=t("span",{class:"font-semibold text-[#543434]"},"Price:",-1)),t("span",we,"₱ "+a(n.value.price_per_kilo)+" per kilo",1)])])]),t("div",xe,[t("div",ke,[e[15]||(e[15]=t("h4",{class:"text-lg font-semibold text-[#543434] mb-2"},"Location",-1)),t("p",_e,a(n.value.location),1),e[16]||(e[16]=t("div",{id:"map",class:"w-full h-48 rounded-lg"},null,-1))]),t("div",ye,[e[18]||(e[18]=t("h4",{class:"text-lg font-semibold text-[#543434] mb-2"},"Contact Seller",-1)),x(B(V),{href:s.route("chat.index",{userId:p.value}),active:s.route("chat.index",{userId:p.value}),class:"inline-block w-full text-center bg-[#c58a61] text-white py-2 px-4 rounded-lg hover:bg-[#b37a51] transition-colors duration-200"},{default:v(()=>e[17]||(e[17]=[O(" Message the Seller ")])),_:1},8,["href","active"])])])]),t("div",Ie,[t("div",Fe,[e[20]||(e[20]=t("h4",{class:"text-lg font-semibold text-[#543434] mb-4"},"Feedback",-1)),u.value.length===0?(r(),l("div",Se," No feedback available. ")):(r(),l("div",je,[(r(!0),l(k,null,_(u.value,o=>(r(),l("div",{key:o.id,class:"bg-white p-3 rounded-lg shadow-sm"},[t("div",Ne,[t("span",Ee,a(o.user.name),1),t("div",Me,[e[19]||(e[19]=t("span",{class:"text-yellow-500 mr-1"},"★",-1)),t("span",Ce,a(o.rating)+"/5",1)])]),t("p",Be,a(o.comment),1)]))),128))]))]),t("div",Te,[e[25]||(e[25]=t("h4",{class:"text-lg font-semibold text-[#543434] mb-4"},"Add Feedback",-1)),t("form",{onSubmit:T(N,["prevent"]),class:"space-y-4"},[t("div",null,[e[22]||(e[22]=t("label",{for:"rating",class:"block text-[#543434] mb-2"},"Rating:",-1)),y(t("select",{id:"rating","onUpdate:modelValue":e[0]||(e[0]=o=>i.value.rating=o),class:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#c58a61] focus:border-[#c58a61]"},e[21]||(e[21]=[P('<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>',5)]),512),[[D,i.value.rating]])]),t("div",null,[e[23]||(e[23]=t("label",{for:"comment",class:"block text-[#543434] mb-2"},"Comment:",-1)),y(t("textarea",{id:"comment","onUpdate:modelValue":e[1]||(e[1]=o=>i.value.comment=o),rows:"3",class:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#c58a61] focus:border-[#c58a61]"},null,512),[[A,i.value.comment]])]),e[24]||(e[24]=t("button",{type:"submit",class:"w-full bg-[#c58a61] text-white py-2 px-4 rounded-lg hover:bg-[#b37a51] transition-colors duration-200"}," Submit Feedback ",-1))],32)])])])])):$("",!0)]))}};export{Oe as default};
