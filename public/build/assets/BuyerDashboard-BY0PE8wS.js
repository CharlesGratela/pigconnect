import{r as c,h as j,c as n,a as C,w as b,b as e,t as r,F as f,m as v,f as D,k as _,v as M,p as P,q as T,g as A,o as i}from"./app-Dh5TspTw.js";import{_ as $}from"./AuthenticatedLayout-CTQH58Fr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const B={class:"flex justify-center"},O={class:"w-[75%]"},R={key:0,class:"text-center text-gray-700 dark:text-gray-300"},V={key:1},z={class:"flex items-center mb-4"},q=["src"],K={class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},L=["onClick"],X={class:"mb-2"},J={class:"text-gray-700 dark:text-gray-300"},U={class:"mb-2"},W={class:"text-gray-700 dark:text-gray-300"},Y={class:"mb-2"},G={class:"text-gray-700 dark:text-gray-300"},H={key:0,class:"fixed inset-0 flex items-center justify-center z-50 bg-gray-800 bg-opacity-75"},Q={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-[90%] md:w-[50%] h-[80%] overflow-y-auto"},Z={class:"mb-4 flex justify-center"},tt=["src"],et={class:"mb-2 text-center"},ot={class:"text-xl text-gray-700 dark:text-gray-300"},at={class:"mb-2 text-center"},st={class:"text-xl text-gray-700 dark:text-gray-300"},rt={class:"mb-2 text-center"},nt={class:"text-xl text-gray-700 dark:text-gray-300"},it={class:"mb-2 text-center"},lt={class:"text-xl text-gray-700 dark:text-gray-300"},dt={class:"mb-2 text-center"},ct={class:"text-xl text-gray-700 dark:text-gray-300"},gt={class:"mb-4"},mt={key:0,class:"text-center text-gray-700 dark:text-gray-300"},ut={key:1},xt={class:"flex justify-between"},pt={class:"font-semibold text-gray-800 dark:text-gray-200"},kt={class:"text-gray-600 dark:text-gray-400"},yt={class:"text-gray-700 dark:text-gray-300"},bt={class:"mb-4"},ft={class:"mb-2"},vt={class:"mb-2"},It={__name:"BuyerDashboard",setup(_t){const m=c([]),u=c(!1),s=c(null),g=c([]),d=c({rating:5,comment:""}),h=async()=>{try{const a=await fetch("/api/recommendations",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok)throw new Error("Network response was not ok");const t=await a.json();m.value=t}catch(a){console.error("Error fetching recommendations:",a),alert("Failed to fetch recommendations")}},k=a=>{const t=new Date(a),o=new Date;return(o.getFullYear()-t.getFullYear())*12+(o.getMonth()-t.getMonth())},w=async a=>{s.value=a,s.value.pigId=a.pigId,console.log(s.value.pigId),u.value=!0,await I(a.user_id),await y(a.pigId),await N(a.id)},F=()=>{u.value=!1},I=async a=>{try{const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),o=await fetch(`/api/pigfarminformation/buyer?user_id=${a}`,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!o.ok)throw new Error("Network response was not ok");const l=await o.json();console.log(l),s.value.id=l.id,s.value.min_price_per_kilo=l.min_price_per_kilo,s.value.max_price_per_kilo=l.max_price_per_kilo,s.value.owner=l.owner_name,s.value.location=l.location;const x=parseFloat(l.latitude),p=parseFloat(l.longitude);isFinite(x)&&isFinite(p)?E(x,p):(console.error("Invalid latitude or longitude:",x,p),alert("Invalid location data"))}catch(t){console.error("Error fetching farm details:",t),alert("Failed to fetch farm details")}},y=async a=>{try{const t=await fetch(`/api/pigs/${a}/feedback`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Network response was not ok");const o=await t.json();g.value=o}catch(t){console.error("Error fetching feedback:",t),alert("Failed to fetch feedback")}},S=async()=>{try{const a=document.querySelector('meta[name="csrf-token"]').getAttribute("content");console.log("Submitting feedback for pig ID:",s.value.pigId);const t=await fetch(`/api/pigs/${s.value.pigId}/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({pig_id:s.value.pigId,comment:d.value.comment,rating:d.value.rating})});if(!t.ok)throw new Error("Network response was not ok");const o=await t.json();g.value.push(o),d.value.rating=5,d.value.comment="",y(s.value.pigId)}catch(a){console.error("Error submitting feedback:",a),alert("Failed to submit feedback")}},N=async a=>{try{const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content");if(!(await fetch("/api/track_interaction",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({pig_id:a})})).ok)throw new Error("Network response was not ok");console.log("Interaction tracked successfully")}catch(t){console.error("Error tracking interaction:",t)}},E=(a,t)=>{const o=new google.maps.Map(document.getElementById("map"),{center:{lat:a,lng:t},zoom:15});new google.maps.Marker({position:{lat:a,lng:t},map:o,title:"Pig Location"})};return j(()=>{h()}),(a,t)=>(i(),n("div",null,[C($,null,{header:b(()=>t[2]||(t[2]=[e("h2",{class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},"Buyer Dashboard",-1)])),default:b(()=>[e("main",null,[e("div",B,[e("div",O,[t[6]||(t[6]=e("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4"},"Recommended Pigs",-1)),m.value.length===0?(i(),n("div",R," No recommendations available. ")):(i(),n("div",V,[(i(!0),n(f,null,v(m.value,o=>(i(),n("div",{key:o.id,class:"mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md"},[e("div",z,[e("img",{src:`/storage/${o.image}`,alt:"Pig Image",class:"w-24 h-24 rounded-lg mr-4 object-cover"},null,8,q),e("div",null,[e("h3",K,r(o.id),1),e("button",{onClick:l=>w(o),class:"text-blue-500 hover:underline"},"View Details",8,L)])]),e("div",X,[t[3]||(t[3]=e("span",{class:"font-semibold text-gray-700 dark:text-gray-300"},"Weight: ",-1)),e("span",J,r(o.weight)+" kg.",1)]),e("div",U,[t[4]||(t[4]=e("span",{class:"font-semibold text-gray-700 dark:text-gray-300"},"Age:",-1)),e("span",W,r(k(o.date_of_birth))+" months",1)]),e("div",Y,[t[5]||(t[5]=e("span",{class:"font-semibold text-gray-700 dark:text-gray-300"},"Price Range:",-1)),e("span",G,r(o.min_price_per_kilo)+" - "+r(o.max_price_per_kilo)+" per kilo",1)])]))),128))]))])])])]),_:1}),u.value?(i(),n("div",H,[e("div",Q,[t[18]||(t[18]=e("h3",{class:"text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4 text-center"},"Pig Details",-1)),e("div",Z,[e("img",{src:`/storage/${s.value.image}`,alt:"Pig Image",class:"w-48 h-48 rounded-lg object-cover"},null,8,tt)]),e("div",et,[t[7]||(t[7]=e("span",{class:"text-xl font-semibold text-gray-700 dark:text-gray-300"},"Owner: ",-1)),e("span",ot,r(s.value.owner),1)]),e("div",at,[t[8]||(t[8]=e("span",{class:"text-xl font-semibold text-gray-700 dark:text-gray-300"},"Weight:",-1)),e("span",st,r(s.value.weight)+" kg",1)]),e("div",rt,[t[9]||(t[9]=e("span",{class:"text-xl font-semibold text-gray-700 dark:text-gray-300"},"Age:",-1)),e("span",nt,r(k(s.value.date_of_birth))+" months",1)]),e("div",it,[t[10]||(t[10]=e("span",{class:"text-xl font-semibold text-gray-700 dark:text-gray-300"},"Price Range:",-1)),e("span",lt,r(s.value.min_price_per_kilo)+" - "+r(s.value.max_price_per_kilo)+" per kilo",1)]),e("div",dt,[t[11]||(t[11]=e("span",{class:"text-xl font-semibold text-gray-700 dark:text-gray-300"},"Location:",-1)),e("span",ct,r(s.value.location),1)]),t[19]||(t[19]=e("div",{id:"map",class:"w-full h-64 mb-4"},null,-1)),e("div",gt,[t[12]||(t[12]=e("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2"},"Feedback",-1)),g.value.length===0?(i(),n("div",mt," No feedback available. ")):(i(),n("div",ut,[(i(!0),n(f,null,v(g.value,o=>(i(),n("div",{key:o.id,class:"mb-2 p-2 bg-gray-100 dark:bg-gray-700 rounded-lg"},[e("div",xt,[e("span",pt,r(o.user.name),1),e("span",kt,r(o.rating)+" / 5",1)]),e("p",yt,r(o.comment),1)]))),128))]))]),e("div",bt,[t[17]||(t[17]=e("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2"},"Add Feedback",-1)),e("form",{onSubmit:D(S,["prevent"])},[e("div",ft,[t[14]||(t[14]=e("label",{for:"rating",class:"block text-gray-700 dark:text-gray-300"},"Rating:",-1)),_(e("select",{id:"rating","onUpdate:modelValue":t[0]||(t[0]=o=>d.value.rating=o),class:"w-full p-2 border rounded-lg"},t[13]||(t[13]=[P('<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>',5)]),512),[[M,d.value.rating]])]),e("div",vt,[t[15]||(t[15]=e("label",{for:"comment",class:"block text-gray-700 dark:text-gray-300"},"Comment:",-1)),_(e("textarea",{id:"comment","onUpdate:modelValue":t[1]||(t[1]=o=>d.value.comment=o),class:"w-full p-2 border rounded-lg"},null,512),[[T,d.value.comment]])]),t[16]||(t[16]=e("button",{type:"submit",class:"mt-2 bg-blue-500 text-white p-2.5 rounded-lg focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:focus:ring-blue-800"},"Submit",-1))],32)]),e("div",{class:"flex justify-center"},[e("button",{onClick:F,class:"mt-4 bg-blue-500 text-white p-2.5 rounded-lg focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:focus:ring-blue-800"},"Close")])])])):A("",!0)]))}};export{It as default};
