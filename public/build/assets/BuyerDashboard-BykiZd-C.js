import{r as c,h as E,c as n,a as j,w as y,b as e,t as r,F as b,p as f,f as C,l as v,v as P,q as T,s as $,g as A,o as l}from"./app-DIld19k6.js";import{_ as B}from"./AuthenticatedLayout-BYUgyG7J.js";const D={class:"flex justify-center"},M={class:"w-[75%]"},O={key:0,class:"text-center text-gray-700 dark:text-gray-300"},R={key:1},V={class:"flex items-center mb-4"},z=["src"],q={class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},K=["onClick"],L={class:"mb-2"},X={class:"text-gray-700 dark:text-gray-300"},J={class:"mb-2"},U={class:"text-gray-700 dark:text-gray-300"},W={class:"mb-2"},G={class:"text-gray-700 dark:text-gray-300"},H={key:0,class:"fixed inset-0 flex items-center justify-center z-50 bg-gray-800 bg-opacity-75"},Q={class:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-[90%] md:w-[50%] h-[80%] overflow-y-auto"},Y={class:"mb-4 flex justify-center"},Z=["src"],tt={class:"mb-2 text-center"},et={class:"text-xl text-gray-700 dark:text-gray-300"},ot={class:"mb-2 text-center"},at={class:"text-xl text-gray-700 dark:text-gray-300"},st={class:"mb-2 text-center"},rt={class:"text-xl text-gray-700 dark:text-gray-300"},nt={class:"mb-2 text-center"},lt={class:"text-xl text-gray-700 dark:text-gray-300"},it={class:"mb-2 text-center"},dt={class:"text-xl text-gray-700 dark:text-gray-300"},ct={class:"mb-4"},gt={key:0,class:"text-center text-gray-700 dark:text-gray-300"},mt={key:1},ut={class:"flex justify-between"},xt={class:"font-semibold text-gray-800 dark:text-gray-200"},pt={class:"text-gray-600 dark:text-gray-400"},kt={class:"text-gray-700 dark:text-gray-300"},yt={class:"mb-4"},bt={class:"mb-2"},ft={class:"mb-2"},wt={__name:"BuyerDashboard",setup(vt){const g=c([]),u=c(!1),s=c(null),m=c([]),d=c({rating:5,comment:""}),_=async()=>{try{const a=await fetch("/api/recommendations",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok)throw new Error("Network response was not ok");const t=await a.json();g.value=t.recommended_items,console.log(g.value)}catch(a){console.error("Error fetching recommendations:",a),alert("Failed to fetch recommendations")}},h=async a=>{s.value=a,s.value.pigId=a.pigId,console.log(s.value.pigId),u.value=!0,await I(a.user_id),await k(a.pigId),await F(s.value.pigId)},w=()=>{u.value=!1},I=async a=>{try{const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),o=await fetch(`/api/pigfarminformation/buyer?user_id=${a}`,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!o.ok)throw new Error("Network response was not ok");const i=await o.json();console.log(i),s.value.id=i.id,s.value.min_price_per_kilo=i.min_price_per_kilo,s.value.max_price_per_kilo=i.max_price_per_kilo,s.value.owner=i.owner_name,s.value.location=i.location;const x=parseFloat(i.latitude),p=parseFloat(i.longitude);isFinite(x)&&isFinite(p)?N(x,p):(console.error("Invalid latitude or longitude:",x,p),alert("Invalid location data"))}catch(t){console.error("Error fetching farm details:",t),alert("Failed to fetch farm details")}},k=async a=>{try{const t=await fetch(`/api/pigs/${a}/feedback`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!t.ok)throw new Error("Network response was not ok");const o=await t.json();m.value=o}catch(t){console.error("Error fetching feedback:",t),alert("Failed to fetch feedback")}},S=async()=>{try{const a=document.querySelector('meta[name="csrf-token"]').getAttribute("content");console.log("Submitting feedback for pig ID:",s.value.pigId);const t=await fetch(`/api/pigs/${s.value.pigId}/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({pig_id:s.value.pigId,comment:d.value.comment,rating:d.value.rating})});if(!t.ok)throw new Error("Network response was not ok");const o=await t.json();m.value.push(o),d.value.rating=5,d.value.comment="",k(s.value.pigId)}catch(a){console.error("Error submitting feedback:",a),alert("Failed to submit feedback")}},F=async a=>{console.log(a);try{const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content");if(!(await fetch("/api/track_interaction",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({pig_id:a})})).ok)throw new Error("Network response was not ok");console.log("Interaction tracked successfully")}catch(t){console.error("Error tracking interaction:",t)}},N=(a,t)=>{const o=new google.maps.Map(document.getElementById("map"),{center:{lat:a,lng:t},zoom:15});new google.maps.Marker({position:{lat:a,lng:t},map:o,title:"Pig Location"})};return E(()=>{_()}),(a,t)=>(l(),n("div",null,[j(B,null,{header:y(()=>t[2]||(t[2]=[e("h2",{class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},"Buyer Dashboard",-1)])),default:y(()=>[e("main",null,[e("div",D,[e("div",M,[t[6]||(t[6]=e("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4"},"Recommended Pigs",-1)),g.value.length===0?(l(),n("div",O," No recommendations available. ")):(l(),n("div",R,[(l(!0),n(b,null,f(g.value,o=>(l(),n("div",{key:o.pigId,class:"mb-4 p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md"},[e("div",V,[e("img",{src:`/storage/${o.image}`,alt:"Pig Image",class:"w-24 h-24 rounded-lg mr-4 object-cover"},null,8,z),e("div",null,[e("h3",q,r(o.pigId),1),e("button",{onClick:i=>h(o),class:"text-blue-500 hover:underline"},"View Details",8,K)])]),e("div",L,[t[3]||(t[3]=e("span",{class:"font-semibold text-gray-700 dark:text-gray-300"},"Weight: ",-1)),e("span",X,r(o.weight)+" kg.",1)]),e("div",J,[t[4]||(t[4]=e("span",{class:"font-semibold text-gray-700 dark:text-gray-300"},"Age:",-1)),e("span",U,r(o.age_in_months)+" months",1)]),e("div",W,[t[5]||(t[5]=e("span",{class:"font-semibold text-gray-700 dark:text-gray-300"},"Price Range:",-1)),e("span",G,r(o.min_price_per_kilo)+" - "+r(o.max_price_per_kilo)+" per kilo",1)])]))),128))]))])])])]),_:1}),u.value?(l(),n("div",H,[e("div",Q,[t[18]||(t[18]=e("h3",{class:"text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4 text-center"},"Pig Details",-1)),e("div",Y,[e("img",{src:`/storage/${s.value.image}`,alt:"Pig Image",class:"w-48 h-48 rounded-lg object-cover"},null,8,Z)]),e("div",tt,[t[7]||(t[7]=e("span",{class:"text-xl font-semibold text-gray-700 dark:text-gray-300"},"Owner: ",-1)),e("span",et,r(s.value.owner),1)]),e("div",ot,[t[8]||(t[8]=e("span",{class:"text-xl font-semibold text-gray-700 dark:text-gray-300"},"Weight:",-1)),e("span",at,r(s.value.weight)+" kg",1)]),e("div",st,[t[9]||(t[9]=e("span",{class:"text-xl font-semibold text-gray-700 dark:text-gray-300"},"Age:",-1)),e("span",rt,r(s.value.age_in_months)+" months",1)]),e("div",nt,[t[10]||(t[10]=e("span",{class:"text-xl font-semibold text-gray-700 dark:text-gray-300"},"Price Range:",-1)),e("span",lt,r(s.value.min_price_per_kilo)+" - "+r(s.value.max_price_per_kilo)+" per kilo",1)]),e("div",it,[t[11]||(t[11]=e("span",{class:"text-xl font-semibold text-gray-700 dark:text-gray-300"},"Location:",-1)),e("span",dt,r(s.value.location),1)]),t[19]||(t[19]=e("div",{id:"map",class:"w-full h-64 mb-4"},null,-1)),e("div",ct,[t[12]||(t[12]=e("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2"},"Feedback",-1)),m.value.length===0?(l(),n("div",gt," No feedback available. ")):(l(),n("div",mt,[(l(!0),n(b,null,f(m.value,o=>(l(),n("div",{key:o.id,class:"mb-2 p-2 bg-gray-100 dark:bg-gray-700 rounded-lg"},[e("div",ut,[e("span",xt,r(o.user.name),1),e("span",pt,r(o.rating)+" / 5",1)]),e("p",kt,r(o.comment),1)]))),128))]))]),e("div",yt,[t[17]||(t[17]=e("h4",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2"},"Add Feedback",-1)),e("form",{onSubmit:C(S,["prevent"])},[e("div",bt,[t[14]||(t[14]=e("label",{for:"rating",class:"block text-gray-700 dark:text-gray-300"},"Rating:",-1)),v(e("select",{id:"rating","onUpdate:modelValue":t[0]||(t[0]=o=>d.value.rating=o),class:"w-full p-2 border rounded-lg"},t[13]||(t[13]=[T('<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>',5)]),512),[[P,d.value.rating]])]),e("div",ft,[t[15]||(t[15]=e("label",{for:"comment",class:"block text-gray-700 dark:text-gray-300"},"Comment:",-1)),v(e("textarea",{id:"comment","onUpdate:modelValue":t[1]||(t[1]=o=>d.value.comment=o),class:"w-full p-2 border rounded-lg"},null,512),[[$,d.value.comment]])]),t[16]||(t[16]=e("button",{type:"submit",class:"mt-2 bg-blue-500 text-white p-2.5 rounded-lg focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:focus:ring-blue-800"},"Submit",-1))],32)]),e("div",{class:"flex justify-center"},[e("button",{onClick:w,class:"mt-4 bg-blue-500 text-white p-2.5 rounded-lg focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:focus:ring-blue-800"},"Close")])])])):A("",!0)]))}};export{wt as default};
